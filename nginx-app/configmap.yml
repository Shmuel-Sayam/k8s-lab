apiVersion: v1
kind: ConfigMap
metadata:
    name: nginx-lab-config
    namespace: lab-security
data:
    main.conf: |
      upstream dvwa_backend {
          server dvwa-lab:80;
      }

      server {
          listen 80;
          server_name _;

          root /usr/share/nginx/html;
          index index.html;

          location = / {
              try_files /index.html =404;
          }

        location /health {
            default_type application/json;
            return 200 '{"status":"UP","environment":"production","cluster":"shmuel-lab","timestamp":"$time_local"}';
        }

          location /dvwa/ {
              proxy_pass http://dvwa_backend/;
              proxy_set_header Host $host:$server_port;
              proxy_set_header X-Real-IP $remote_addr;
              proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
              proxy_set_header X-Forwarded-Proto $scheme;
              proxy_redirect http://dvwa-lab/ /dvwa/;
          }

          location /dvwa {
            return 301 $scheme://$http_host:30083/dvwa/;
        }
      }

    index.html: |
        <!DOCTYPE html>
        <html lang="en">
        <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Shmuel Lab - Concept Control</title>
        <style>
            :root {
                --bg-gradient: linear-gradient(-45deg, #020617, #0f172a, #1e293b, #020617);
                --panel: rgba(255, 255, 255, 0.04);
                --border: rgba(255, 255, 255, 0.1);
                --text: #e5e7eb;
                --muted: #9ca3af;
                --accent: #22c55e;
                --radius: 20px;
            }

            * { box-sizing: border-box; margin: 0; padding: 0; }

            body {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                background: var(--bg-gradient);
                background-size: 400% 400%;
                animation: gradientBG 15s ease infinite;
                color: var(--text);
                min-height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;
                overflow-x: hidden;
            }

            @keyframes gradientBG {
                0% { background-position: 0% 50%; }
                50% { background-position: 100% 50%; }
                100% { background-position: 0% 50%; }
            }

            .page { 
                max-width: 1100px; 
                width: 100%; 
                padding: 40px 20px;
                margin: auto;
            }

            .hero {
                background: rgba(15, 23, 42, 0.6);
                backdrop-filter: blur(12px);
                -webkit-backdrop-filter: blur(12px);
                border-radius: 24px;
                padding: 40px;
                box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
                border: 1px solid var(--border);
                margin-bottom: 30px;
                text-align: left;
            }

            .hero-tag {
                display: inline-flex; align-items: center; gap: 8px;
                font-size: 10px; font-weight: 700; letter-spacing: .2em; text-transform: uppercase;
                color: var(--accent);
                padding: 6px 14px; border-radius: 999px;
                background: rgba(34, 197, 94, 0.1);
                border: 1px solid rgba(34, 197, 94, 0.2);
                margin-bottom: 20px;
            }

            .hero-title { font-size: 36px; font-weight: 800; margin-bottom: 12px; letter-spacing: -0.02em; }
            .hero-subtitle { font-size: 16px; color: var(--muted); max-width: 600px; line-height: 1.6; }

            .grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 20px;
                margin-top: 20px;
            }

            .card {
                background: var(--panel);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                border-radius: var(--radius);
                padding: 24px;
                border: 1px solid var(--border);
                display: flex;
                flex-direction: column;
                justify-content: space-between;
                transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                min-height: 200px;
            }

            .card:hover {
                transform: translateY(-8px);
                background: rgba(255, 255, 255, 0.07);
                border-color: var(--accent);
                box-shadow: 0 20px 40px rgba(0,0,0,0.4), 0 0 20px rgba(34, 197, 94, 0.1);
            }

            .status-dot {
                height: 8px; width: 8px;
                background-color: var(--accent);
                border-radius: 50%;
                display: inline-block;
                margin-right: 10px;
                box-shadow: 0 0 10px var(--accent);
                animation: pulse 2s infinite;
            }

            @keyframes pulse {
                0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
                70% { transform: scale(1); box-shadow: 0 0 0 6px rgba(34, 197, 94, 0); }
                100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
            }

            .card-title { font-size: 18px; font-weight: 700; display: flex; align-items: center; }
            .card-body { font-size: 13px; color: var(--muted); line-height: 1.6; margin: 15px 0; }

            .btn {
                display: inline-flex; align-items: center; justify-content: center;
                font-size: 13px; font-weight: 700; padding: 10px 20px;
                border-radius: 12px; text-decoration: none;
                transition: all 0.3s ease; color: #022c22;
                background: var(--accent);
                box-shadow: 0 10px 20px rgba(34, 197, 94, 0.2);
            }

            .btn:hover { transform: scale(1.05); filter: brightness(1.1); }

            .footer { margin-top: 40px; font-size: 12px; text-align: center; color: var(--muted); opacity: 0.6; }

            @media (max-width:640px){
                .hero { padding: 30px 20px; }
                .hero-title { font-size: 26px; }
            }
        </style>
        </head>
        <body>
        <main class="page">
            <section class="hero">
                <div class="hero-tag">Lab Status: Online</div>
                <h1 class="hero-title">Cloud Native Sandbox</h1>
                <p class="hero-subtitle">Welcome to Shmuel's Concept Control. A fully automated GitOps environment for security research and Kubernetes orchestration.</p>
                <div id="cards" class="grid"></div>
                <p class="footer">Built with NGINX & Kubernetes â€¢ 2025 Lab Edition</p>
            </section>
        </main>

        <script>
            const cards = [
                { title: "Argo CD", body: "Real-time GitOps synchronization and deployment lifecycle management.", href: "https://192.168.10.25:30082", cta: "Launch Console" },
                { title: "Nginx Health", body: "Verify infrastructure connectivity and routing health.", href: "http://192.168.10.25:30083/health", cta: "Health Status" },
                { title: "DVWA App", body: "Target environment for penetration testing and security auditing.", href: "http://192.168.10.25:30083/dvwa/login.php", cta: "Start Testing" },
                { title: "Grafana", body: "Advanced observability and cluster metrics visualization.", href: "http://192.168.10.25:30900", cta: "View Dashboards" },
                { title: "GitHub Repo", body: "Source code, YAML manifests and lab documentation.", href: "https://github.com/Shmuel-Sayam/k8s-lab/", cta: "View Source" }
            ];

            document.getElementById("cards").innerHTML = cards.map(c => `
                <article class="card">
                    <div>
                        <h2 class="card-title"><span class="status-dot"></span>${c.title}</h2>
                        <p class="card-body">${c.body}</p>
                    </div>
                    <a class="btn" href="${c.href}" target="_blank">${c.cta}</a>
                </article>
            `).join("");
        </script>
        </body>
        </html>